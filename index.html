<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polished Tennis Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #1a1a1a;
            font-family: 'Roboto', sans-serif;
            color: white;
        }
        canvas {
            background: linear-gradient(to bottom, #006400, #004d00); /* Subtle gradient for court */
            border: 2px solid white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }
        .button {
            transition: opacity 0.2s ease;
        }
        .button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- GAME STATE & SETTINGS ---
        let gameState = 'startScreen'; // 'startScreen', 'difficultyScreen', 'playing', 'paused', 'gameOver'
        let totalSets = 1;
        let gameSettings = { difficulty: '' };
        let hoverButton = null;

        // --- UI BUTTONS ---
        const stopButton = { x: canvas.width - 120, y: 10, width: 110, height: 40 };
        const restartButton = { x: canvas.width - 120, y: 60, width: 110, height: 40 };
        const resumeButton = { x: canvas.width/2 - 80, y: 360, width: 160, height: 60 };
        const easyButton = { x: canvas.width/2 - 230, y: 360, width: 210, height: 60 };
        const hardButton = { x: canvas.width/2 + 20, y: 360, width: 210, height: 60 };
        const setButtons = [
            { x: 250, y: 360, width: 110, height: 60, sets: 1 },
            { x: 375, y: 360, width: 110, height: 60, sets: 3 },
            { x: 500, y: 360, width: 110, height: 60, sets: 5 }
        ];
        const mainMenuButton = { x: 320, y: 410, width: 160, height: 60 };

        // --- GAME OBJECTS ---
        const player = {
            x: 100, y: canvas.height / 2 - 50, width: 20, height: 80,
            racketLength: 75, racketWidth: 10, color: '#4a90e2',
            speed: 8, score: 0, sets: 0
        };
        const ai = {
            x: canvas.width - 120, y: canvas.height / 2 - 50, width: 20, height: 80,
            racketLength: 75, racketWidth: 10, color: '#e25a4a',
            speed: 4, score: 0, sets: 0
        };
        const ball = {
            x: canvas.width / 2, y: canvas.height / 2, radius: 10,
            speedX: 3.5, speedY: 3.5, baseSpeedX: 3.5, color: '#FFFF00'
        };
        const swing = {
            active: false, angle: 0, direction: 1, 
            speed: 15, targetAngle: 90
        };
        const keys = { ArrowUp: false, ArrowDown: false };

        // --- EVENT LISTENERS ---
        document.addEventListener('keydown', (e) => {
            if (gameState === 'playing') {
                if (e.key in keys) keys[e.key] = true;
                if (e.code === 'Space' && !swing.active) {
                    const playerCenterY = player.y + player.height / 2;
                    if (ball.y > playerCenterY) swing.targetAngle = 90;
                    else swing.targetAngle = -90;
                    swing.direction = Math.sign(swing.targetAngle);
                    swing.active = true;
                }
            }
        });
        document.addEventListener('keyup', (e) => {
            if (e.key in keys) keys[e.key] = false;
        });
        
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            switch(gameState) {
                case 'startScreen': handleStartScreenClick(mouseX, mouseY); break;
                case 'difficultyScreen': handleDifficultyClick(mouseX, mouseY); break;
                case 'playing': handlePlayingClick(mouseX, mouseY); break;
                case 'paused': handlePausedClick(mouseX, mouseY); break;
                case 'gameOver': handleGameOverClick(mouseX, mouseY); break;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            hoverButton = null;
            if (gameState === 'playing') {
                if (isPointInRect(mouseX, mouseY, stopButton)) hoverButton = stopButton;
                if (isPointInRect(mouseX, mouseY, restartButton)) hoverButton = restartButton;
            } else if (gameState === 'paused' && isPointInRect(mouseX, mouseY, resumeButton)) {
                hoverButton = resumeButton;
            } else if (gameState === 'difficultyScreen') {
                if (isPointInRect(mouseX, mouseY, easyButton)) hoverButton = easyButton;
                if (isPointInRect(mouseX, mouseY, hardButton)) hoverButton = hardButton;
            } else if (gameState === 'startScreen') {
                setButtons.forEach(btn => {
                    if (isPointInRect(mouseX, mouseY, btn)) hoverButton = btn;
                });
            } else if (gameState === 'gameOver' && isPointInRect(mouseX, mouseY, mainMenuButton)) {
                hoverButton = mainMenuButton;
            }
        });

        function isPointInRect(x, y, rect) {
            return x > rect.x && x < rect.x + rect.width && y > rect.y && y < rect.y + rect.height;
        }
        
        function handleStartScreenClick(mx, my) {
            setButtons.forEach(btn => {
                if (isPointInRect(mx, my, btn)) {
                    totalSets = btn.sets;
                    gameState = 'difficultyScreen';
                }
            });
        }
        
        function handleDifficultyClick(mx, my) {
            if (isPointInRect(mx, my, easyButton)) startGame('easy');
            if (isPointInRect(mx, my, hardButton)) startGame('hard');
        }

        function handlePlayingClick(mx, my) {
            if (isPointInRect(mx, my, stopButton)) gameState = 'paused';
            if (isPointInRect(mx, my, restartButton)) gameState = 'startScreen';
        }

        function handlePausedClick(mx, my) {
            if (isPointInRect(mx, my, resumeButton)) gameState = 'playing';
        }

        function handleGameOverClick(mx, my) {
            if (isPointInRect(mx, my, mainMenuButton)) gameState = 'startScreen';
        }

        // --- GAME LOGIC ---
        function setDifficulty(difficulty) {
            if (difficulty === 'easy') {
                gameSettings = { ballSpeed: 3.5, aiSpeed: 3.0, playerRacketLength: 85, aiRacketLength: 65, difficulty: 'Easy' };
            } else { // hard
                gameSettings = { ballSpeed: 5.2, aiSpeed: 5.0, playerRacketLength: 80, aiRacketLength: 90, difficulty: 'Hard' };
            }
            ball.baseSpeedX = gameSettings.ballSpeed;
            ai.speed = gameSettings.aiSpeed;
            player.racketLength = gameSettings.playerRacketLength;
            ai.racketLength = gameSettings.aiRacketLength;
        }

        function startGame(difficulty) {
            setDifficulty(difficulty);
            player.score = 0; ai.score = 0;
            player.sets = 0; ai.sets = 0;
            resetBall(true);
            gameState = 'playing';
        }

        function update() {
            if (gameState !== 'playing') return;

            if (keys.ArrowUp && player.y > 0) player.y -= player.speed;
            if (keys.ArrowDown && player.y < canvas.height - player.height) player.y += player.speed;
            
            if (swing.active) {
                swing.angle += swing.speed * swing.direction;
                if (Math.abs(swing.angle) >= Math.abs(swing.targetAngle)) swing.direction *= -1;
                if ((swing.direction === -1 && swing.angle <= 0 && swing.targetAngle > 0) || (swing.direction === 1 && swing.angle >= 0 && swing.targetAngle < 0)) {
                    swing.active = false; swing.angle = 0;
                }
            }

            ball.x += ball.speedX;
            ball.y += ball.speedY;

            if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) ball.speedY = -ball.speedY;

            const racketTipX = player.x + player.width + Math.cos(swing.angle * Math.PI / 180) * player.racketLength;
            if (ball.speedX < 0 && ball.x - ball.radius < racketTipX && ball.x + ball.radius > player.x && ball.y > player.y && ball.y < player.y + player.height) {
                ball.speedX = -ball.speedX;
                if (swing.active) {
                    ball.speedX *= 1.2;
                    ball.speedY = (ball.y - (player.y + player.height / 2)) * 0.25;
                }
            }

            const aiRacketTipX = ai.x - ai.racketLength;
            if (ball.speedX > 0 && ball.x + ball.radius > aiRacketTipX && ball.x + ball.radius < ai.x + ai.width && ball.y > ai.y && ball.y < ai.y + ai.height) {
                ball.speedX = -ball.speedX;
            }

            if (ball.x + ball.radius < 0) {
                ai.score++; checkSetWin(); resetBall(true);
            } else if (ball.x - ball.radius > canvas.width) {
                player.score++; checkSetWin(); resetBall(false);
            }
            
            const aiCenter = ai.y + ai.height / 2;
            if (ball.speedX > 0) {
                const randomOffset = (Math.random() - 0.5) * (gameSettings.aiSpeed === 3.0 ? 20 : 16); // ±10 for Easy, ±8 for Hard
                const targetY = ball.y + randomOffset;
                if (aiCenter < targetY - 15) ai.y += ai.speed;
                else if (aiCenter > targetY + 15) ai.y -= ai.speed;
            }
        }
        
        function checkSetWin() {
            if (player.score >= 6 || ai.score >= 6) {
                const pointDifference = Math.abs(player.score - ai.score);
                if (pointDifference >= 2) {
                    if (player.score > ai.score) player.sets++;
                    else ai.sets++;
                    player.score = 0;
                    ai.score = 0;
                }
            }
            const setsToWin = Math.ceil(totalSets / 2);
            if (player.sets >= setsToWin || ai.sets >= setsToWin) gameState = 'gameOver';
        }

        function resetBall(serveToPlayer) {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.speedY = Math.random() > 0.5 ? ball.baseSpeedX : -ball.baseSpeedX;
            ball.speedX = serveToPlayer ? -ball.baseSpeedX : ball.baseSpeedX;
        }

        // --- DRAWING FUNCTIONS ---
        function draw() {
            ctx.fillStyle = '#006400';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (gameState === 'startScreen') drawStartScreen();
            else if (gameState === 'difficultyScreen') drawDifficultyScreen();
            else if (gameState === 'playing' || gameState === 'paused') {
                drawPlayingField();
                drawPlayer();
                drawAI();
                drawBall();
                drawScore();
                drawInGameButtons();
                if(gameState === 'paused') drawPausedOverlay();
            } else if (gameState === 'gameOver') drawGameOverScreen();
            
            requestAnimationFrame(gameLoop);
        }
        
        function drawPlayingField() {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 4;
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.save();
            ctx.translate(player.x + player.width / 2, player.y + player.height / 2);
            ctx.rotate(swing.angle * Math.PI / 180);
            ctx.fillStyle = '#654321';
            ctx.fillRect(player.width / 2, -player.racketWidth / 2, player.racketLength / 2, player.racketWidth);
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(player.width / 2 + player.racketLength * 0.75, 0, player.racketLength / 4, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.restore();
        }

        function drawAI() {
            ctx.fillStyle = ai.color;
            ctx.fillRect(ai.x, ai.y, ai.width, ai.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(ai.x - ai.racketLength, ai.y + ai.height / 2 - ai.racketWidth / 2, ai.racketLength, ai.racketWidth);
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ball.color;
            ctx.fill();
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '26px Roboto';
            ctx.textAlign = 'center';
            const scoreText = `Player: ${player.score} | Bot: ${ai.score}`;
            const setText = `Sets: ${player.sets} - ${ai.sets}`;
            const gameInfo = `${gameSettings.difficulty} Mode | ${totalSets} Set${totalSets > 1 ? 's' : ''}`;
            ctx.fillText(scoreText, canvas.width / 2, 30);
            ctx.font = '20px Roboto';
            ctx.fillText(setText, canvas.width / 2, 60);
            ctx.font = '16px Roboto';
            ctx.fillText(gameInfo, canvas.width / 2, 90);
        }

        function drawInGameButtons() {
            ctx.fillStyle = '#e25a4a';
            ctx.fillRect(stopButton.x, stopButton.y, stopButton.width, stopButton.height, 10);
            ctx.fillStyle = 'white';
            ctx.font = '20px Roboto';
            ctx.textAlign = 'center';
            ctx.globalAlpha = hoverButton === stopButton ? 0.8 : 1;
            ctx.fillText('Stop', stopButton.x + stopButton.width / 2, stopButton.y + 28);
            ctx.globalAlpha = 1;

            ctx.fillStyle = '#4a90e2';
            ctx.fillRect(restartButton.x, restartButton.y, restartButton.width, restartButton.height, 10);
            ctx.fillStyle = 'white';
            ctx.globalAlpha = hoverButton === restartButton ? 0.8 : 1;
            ctx.fillText('Restart', restartButton.x + restartButton.width / 2, restartButton.y + 28);
            ctx.globalAlpha = 1;
        }

        function drawPausedOverlay() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.font = '50px Roboto';
            const pulse = 1 + Math.sin(Date.now() / 200) * 0.05; // Subtle pulse animation
            ctx.globalAlpha = pulse;
            ctx.fillText('Paused', canvas.width / 2, canvas.height / 2);
            ctx.globalAlpha = 1;
            ctx.fillStyle = '#DDDDDD';
            ctx.fillRect(resumeButton.x, resumeButton.y, resumeButton.width, resumeButton.height, 10);
            ctx.fillStyle = 'black';
            ctx.font = '26px Roboto';
            ctx.globalAlpha = hoverButton === resumeButton ? 0.8 : 1;
            ctx.fillText('Resume', resumeButton.x + resumeButton.width / 2, resumeButton.y + 40);
            ctx.globalAlpha = 1;
        }
        
        function drawStartScreen() {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'white';
            ctx.font = '50px Roboto';
            ctx.fillText('HTML5 Tennis', canvas.width / 2, 150);
            ctx.font = '30px Roboto';
            ctx.fillText('Choose number of sets to win:', canvas.width / 2, 300);
            ctx.font = '24px Roboto';
            setButtons.forEach(btn => {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.globalAlpha = hoverButton === btn ? 0.8 : 1;
                ctx.fillRect(btn.x, btn.y, btn.width, btn.height, 10);
                ctx.fillStyle = 'black';
                ctx.fillText(`${btn.sets} Set${btn.sets > 1 ? 's' : ''}`, btn.x + btn.width / 2, btn.y + 40);
                ctx.globalAlpha = 1;
            });
        }
        
        function drawDifficultyScreen() {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'white';
            ctx.font = '50px Roboto';
            ctx.fillText('Select Difficulty', canvas.width / 2, 200);

            ctx.fillStyle = '#6ab04c';
            ctx.globalAlpha = hoverButton === easyButton ? 0.8 : 1;
            ctx.fillRect(easyButton.x, easyButton.y, easyButton.width, easyButton.height, 10);
            ctx.fillStyle = 'white';
            ctx.font = '26px Roboto';
            ctx.fillText('Easy Mode', easyButton.x + easyButton.width / 2, easyButton.y + 40);
            ctx.globalAlpha = 1;

            ctx.fillStyle = '#e25a4a';
            ctx.globalAlpha = hoverButton === hardButton ? 0.8 : 1;
            ctx.fillRect(hardButton.x, hardButton.y, hardButton.width, hardButton.height, 10);
            ctx.fillStyle = 'white';
            ctx.fillText('Hard Mode', hardButton.x + hardButton.width / 2, hardButton.y + 40);
            ctx.globalAlpha = 1;
        }

        function drawGameOverScreen() {
            ctx.textAlign = 'center';
            ctx.fillStyle = 'white';
            ctx.font = '50px Roboto';
            const winner = player.sets > ai.sets ? 'You Win!' : 'Bot Wins!';
            const pulse = 1 + Math.sin(Date.now() / 200) * 0.05; // Subtle pulse animation
            ctx.globalAlpha = pulse;
            ctx.fillText('Game Over', canvas.width / 2, 200);
            ctx.fillText(winner, canvas.width / 2, 300);
            ctx.globalAlpha = 1;
            ctx.font = '30px Roboto';
            ctx.fillText(`Final Sets: ${player.sets} - ${ai.sets}`, canvas.width / 2, 350);
            ctx.fillStyle = '#DDDDDD';
            ctx.globalAlpha = hoverButton === mainMenuButton ? 0.8 : 1;
            ctx.fillRect(mainMenuButton.x, mainMenuButton.y, mainMenuButton.width, mainMenuButton.height, 10);
            ctx.fillStyle = 'black';
            ctx.font = '26px Roboto';
            ctx.fillText('Main Menu', mainMenuButton.x + mainMenuButton.width / 2, mainMenuButton.y + 40);
            ctx.globalAlpha = 1;
        }

        function gameLoop() {
            update();
            draw();
        }

        draw();
    </script>
</body>
</html>
